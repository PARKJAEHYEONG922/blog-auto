"""
ë¸”ë¡œê·¸ ìë™í™” AI í”„ë¡¬í”„íŠ¸ ë° êµ¬ì¡°í™”ëœ ë°ì´í„° ìƒì„±
"""
from typing import Dict, List, Any
from src.foundation.logging import get_logger

logger = get_logger("blog_automation.ai_prompts")


class BlogContentStructure:
    """ë¸”ë¡œê·¸ ì½˜í…ì¸  êµ¬ì¡° ë¶„ì„ ë° AIìš© ë°ì´í„° ìƒì„±"""
    
    def __init__(self):
        self.content_elements = []
        self.analysis_data = {}
    
    def analyze_blog_structure(self, analyzed_blogs: List[Dict]) -> Dict:
        """ë¶„ì„ëœ ë¸”ë¡œê·¸ë“¤ì˜ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ AIìš© ë°ì´í„° ìƒì„±"""
        try:
            structured_data = {
                "keyword": "",
                "competitor_analysis": {
                    "top_blogs": [],
                    "summary": {
                        "total_blogs": len(analyzed_blogs),
                        "avg_content_length": 0,
                        "common_tags": [],
                        "content_patterns": []
                    }
                }
            }
            
            total_length = 0
            all_tags = []
            
            for blog in analyzed_blogs:
                # ê°œë³„ ë¸”ë¡œê·¸ êµ¬ì¡° ë¶„ì„
                blog_structure = self.extract_blog_structure(blog)
                structured_data["competitor_analysis"]["top_blogs"].append(blog_structure)
                
                # í†µê³„ ê³„ì‚°ìš©
                total_length += blog.get('content_length', 0)
                all_tags.extend(blog.get('tags', []))
            
            # í‰ê·  ë° ê³µí†µ íŒ¨í„´ ê³„ì‚°
            if analyzed_blogs:
                structured_data["competitor_analysis"]["summary"]["avg_content_length"] = total_length // len(analyzed_blogs)
                
                # ê°€ì¥ ë§ì´ ì‚¬ìš©ëœ íƒœê·¸ ìƒìœ„ 5ê°œ
                from collections import Counter
                tag_counter = Counter(all_tags)
                structured_data["competitor_analysis"]["summary"]["common_tags"] = [
                    tag for tag, count in tag_counter.most_common(5)
                ]
            
            return structured_data
            
        except Exception as e:
            logger.error(f"ë¸”ë¡œê·¸ êµ¬ì¡° ë¶„ì„ ì‹¤íŒ¨: {e}")
            return {}
    
    def extract_blog_structure(self, blog: Dict) -> Dict:
        """ê°œë³„ ë¸”ë¡œê·¸ì˜ êµ¬ì¡° ì¶”ì¶œ"""
        return {
            "rank": blog.get('rank', 0),
            "title": blog.get('title', ''),
            "url": blog.get('url', ''),
            "statistics": {
                "content_length": blog.get('content_length', 0),
                "image_count": blog.get('image_count', 0),
                "gif_count": blog.get('gif_count', 0),
                "video_count": blog.get('video_count', 0),
                "tag_count": len(blog.get('tags', []))
            },
            "tags": blog.get('tags', []),
            "content_preview": blog.get('text_content', '')[:200] + "..." if blog.get('text_content', '') else ''
        }


class BlogAIPrompts:
    """ë¸”ë¡œê·¸ AI ìƒì„±ì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿"""
    
    @staticmethod
    def generate_naver_seo_prompt(keyword: str, structured_data: Dict) -> str:
        """ë„¤ì´ë²„ SEO ìµœì í™” í”„ë¡¬í”„íŠ¸ ìƒì„± (ìƒˆë¡œìš´ ë²„ì „)"""
        
        competitor_info = structured_data.get("competitor_analysis", {})
        top_blogs = competitor_info.get("top_blogs", [])
        summary = competitor_info.get("summary", {})
        
        # í‰ê·  ê³„ì‚°
        avg_content_length = summary.get('avg_content_length', 1500)
        total_images = sum(blog['statistics']['image_count'] for blog in top_blogs) if top_blogs else 3
        avg_images = total_images // len(top_blogs) if top_blogs else 3
        
        prompt = f"""[AI ì—­í•  ë° í˜ë¥´ì†Œë‚˜ ì„¤ì •] 
ë‹¹ì‹ ì€ 15ë…„ ê²½ë ¥ì˜ ë„¤ì´ë²„ ë¸”ë¡œê·¸ ì „ë¬¸ ë§ˆì¼€í„°ì´ì SEO ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì ì¬ ê³ ê°ì˜ ê²€ìƒ‰ ì˜ë„ë¥¼ ì •í™•íˆ íŒŒì•…í•˜ê³ , ê·¸ë“¤ì´ í¥ë¯¸ë¡œì›Œí•  ë§Œí•œ ê¹Šì´ ìˆê³  ìœ ì¼ë¬´ì´í•œ ì½˜í…ì¸ ë¥¼ ì „ë¬¸ì ì´ê³  ì¹œê·¼í•œ ì–´ì¡°ë¡œ ì‘ì„±í•˜ì—¬ ë§¤ì¶œ ì „í™˜ì„ ìœ ë„í•˜ëŠ” ê²ƒì´ ë‹¹ì‹ ì˜ ëª©í‘œì…ë‹ˆë‹¤. ë„¤ì´ë²„ì˜ C-Rank, DIA, Air Search ë¡œì§ì„ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ê³  ì´ë¥¼ ê¸€ì“°ê¸°ì— ì ìš©í•´ì•¼ í•©ë‹ˆë‹¤.

[ì‘ì—… ë‚´ìš© ë° ëª©í‘œ] 
ì£¼ì–´ì§„ í‚¤ì›Œë“œì— ëŒ€í•´ ìƒìœ„ ë…¸ì¶œì„ ëª©í‘œë¡œ í•˜ëŠ” ë„¤ì´ë²„ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì„ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤. ë‚´ê°€ ì œê³µí•˜ëŠ” ìƒìœ„ 3ê°œ ë¸”ë¡œê·¸ ê¸€ ë°ì´í„°ë¥¼ ì² ì €íˆ ë¶„ì„í•˜ì—¬ ìš°ë¦¬ ê¸€ì— ìµœëŒ€í•œ ë°˜ì˜í•˜ê³ , ë„¤ì´ë²„ ê²€ìƒ‰ ì—”ì§„ ìµœì í™”(SEO) ì›ì¹™ì„ ì¤€ìˆ˜í•˜ì—¬ ë†’ì€ í’ˆì§ˆì˜ ê¸€ì„ ìƒì„±í•´ ì£¼ì„¸ìš”.

[íƒ€ê²Ÿ í‚¤ì›Œë“œ ë° ê¸€ ì£¼ì œ]
â€¢ íƒ€ê²Ÿ í‚¤ì›Œë“œ: "{keyword}"
â€¢ ê¸€ ì£¼ì œ: "{keyword} ê´€ë ¨ ì „ë¬¸ì ì´ê³  ìœ ìš©í•œ ì •ë³´ ì œê³µ"

[ìƒìœ„ 3ê°œ ë¸”ë¡œê·¸ ë°ì´í„° ë¶„ì„ ë° ì ìš© ì§€ì‹œ]
ë‹¤ìŒì€ {keyword}ë¡œ ìƒìœ„ ë…¸ì¶œëœ ë¸”ë¡œê·¸ ê¸€ 3ê°œì˜ ë°ì´í„°ì…ë‹ˆë‹¤. ì´ ë°ì´í„°ë¥¼ ë©´ë°€íˆ ë¶„ì„í•˜ì—¬ ìš°ë¦¬ ê¸€ ì‘ì„±ì— ë°˜ì˜í•´ ì£¼ì„¸ìš”.
"""
        
        # ê° ë¸”ë¡œê·¸ ì •ë³´ ì¶”ê°€
        for i, blog in enumerate(top_blogs[:3], 1):
            stats = blog.get('statistics', {})
            prompt += f"""
â€¢ ë¸”ë¡œê·¸ #{i}:
    â—¦ ì œëª©: {blog.get('title', 'ì œëª© ì—†ìŒ')}
    â—¦ ì´ë¯¸ì§€ ìˆ˜: {stats.get('image_count', 0)}ì¥
    â—¦ GIF ìˆ˜: {stats.get('gif_count', 0)}ê°œ
    â—¦ ë™ì˜ìƒ ìˆ˜: {stats.get('video_count', 0)}ê°œ
    â—¦ ê¸€ì ìˆ˜ (ê³µë°± ì œì™¸): {stats.get('content_length', 0)}ì"""
        
        prompt += f"""

ìœ„ ë°ì´í„° ë¶„ì„ ê²°ê³¼ ì ìš© ê°€ì´ë“œë¼ì¸:
1. ì œëª© ì‘ì„±:
    â—¦ ì œê³µëœ ìƒìœ„ ë¸”ë¡œê·¸ 3ê°œì˜ ì œëª©ê³¼ ìœ ì‚¬í•˜ì§€ ì•Šìœ¼ë©´ì„œë„ ë…ì°½ì ì´ê³  ë§¤ë ¥ì ì¸ ì œëª©ì„ ìƒì„±í•´ ì£¼ì„¸ìš”.
    â—¦ ì œëª©ì€ ëª…í™•í•˜ê³  ê°„ê²°í•´ì•¼ í•˜ë©°, ì‚¬ìš©ìì˜ ê²€ìƒ‰ ì˜ë„ë¥¼ ì´í•´í•˜ê³  ì›í•˜ëŠ” ì •ë³´ê°€ ê¸€ì— ë‹´ê²¨ìˆìŒì„ ì˜ í‘œí˜„í•´ì•¼ í•©ë‹ˆë‹¤.
    â—¦ íƒ€ê²Ÿ í‚¤ì›Œë“œë¥¼ ì œëª© ë§¨ ì•ì— ë°°ì¹˜í•´ ì£¼ì„¸ìš”.
    â—¦ ì—¬ëŸ¬ í‚¤ì›Œë“œë¥¼ í•œ ì œëª©ì— ë‚˜ì—´í•˜ëŠ” ë©€í‹° í‚¤ì›Œë“œ ì‚½ì… ì „ëµì€ í”¼í•˜ê³ , í•˜ë‚˜ì˜ í‚¤ì›Œë“œì— ì§‘ì¤‘í•˜ì—¬ ì‘ì„±í•´ ì£¼ì„¸ìš”.

2. ê¸€ì ìˆ˜:
    â—¦ ìƒìœ„ ë…¸ì¶œëœ 1~3ìœ„ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…ì˜ í‰ê·  ê¸€ì ìˆ˜({avg_content_length}ì)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìµœì í™”í•´ ì£¼ì„¸ìš”.
    â—¦ ëª©í‘œ ê¸€ì ìˆ˜: {avg_content_length + 200}ì (ê³µë°± ì œì™¸) - ê²½ìŸì‚¬ë³´ë‹¤ ì•½ê°„ ë” ê¸¸ê²Œ
    â—¦ 2,000ìë¥¼ ë„˜ì§€ ì•Šë„ë¡ ì£¼ì˜í•´ ì£¼ì„¸ìš”.

3. ì´ë¯¸ì§€, GIF, ë™ì˜ìƒ ìˆ˜:
    â—¦ ìƒìœ„ 1~3ìœ„ ë¸”ë¡œê·¸ ê¸€ì˜ í‰ê·  ì´ë¯¸ì§€ ìˆ˜({avg_images}ì¥)ë¥¼ ì°¸ê³ í•˜ì—¬ ì ì ˆí•œ ìˆ˜ì˜ ì´ë¯¸ì§€ ë°°ì¹˜ ê³„íš
    â—¦ ì´ ê¸€ì—ëŠ” {avg_images + 1}ì¥ ì´ìƒì˜ ì´ë¯¸ì§€ë¥¼ ì‚½ì…í•  ì˜ˆì •ì…ë‹ˆë‹¤.
    â—¦ ë™ì˜ìƒì€ ìµœì†Œ 1ê°œ ì´ìƒ í¬í•¨í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

4. í‚¤ì›Œë“œ ë°˜ë³µ íšŸìˆ˜:
    â—¦ ê¸€ ì „ì²´ì—ì„œ íƒ€ê²Ÿ í‚¤ì›Œë“œê°€ 5~6íšŒ ì •ë„ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ë³µë˜ë„ë¡ ì‘ì„±í•´ ì£¼ì„¸ìš”.
    â—¦ ì†Œì œëª©ì— í•„ìˆ˜ í‚¤ì›Œë“œë¥¼ ì‚½ì…í•˜ì—¬ ìŠ¤ë§ˆíŠ¸ ë¸”ë¡ ë…¸ì¶œì— ìœ ë¦¬í•œ êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.
    â—¦ ê¸€ ì„œë¡  ë¶€ë¶„ì— íƒ€ê²Ÿ í‚¤ì›Œë“œë¥¼ ë°˜ë“œì‹œ ì–¸ê¸‰í•´ ì£¼ì„¸ìš”.

[ê¸€ì“°ê¸° ìƒì„¸ ì§€ì‹œì‚¬í•­ (ë„¤ì´ë²„ SEO ìµœì í™”)]
1. ê¸€ì˜ êµ¬ì„± ë° íë¦„:
    â—¦ ì„œë¡ (10-15%): ë…ìì˜ ê´€ì‹¬ì„ ëŒê³  ë¬¸ì œë¥¼ ì œì‹œí•˜ë©°, ì´ˆë°˜ 3ì´ˆ ë‚´ì— ë…ìê°€ ì›í•˜ëŠ” í•µì‹¬ ì •ë³´ë¥¼ ëª…í™•íˆ ì œì‹œí•˜ê³ , ê°œì¸ì˜ ê²½í—˜ì´ë‚˜ ê°ì •ì„ ë‹´ì•„ ê³µê°ëŒ€ë¥¼ í˜•ì„±í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì‹œì‘í•´ ì£¼ì„¸ìš”. íƒ€ê²Ÿ í‚¤ì›Œë“œë¥¼ ë°˜ë“œì‹œ ì–¸ê¸‰í•´ì•¼ í•©ë‹ˆë‹¤.
    â—¦ ë³¸ë¡ (70-80%): êµ¬ì²´ì ì¸ ì •ë³´ì™€ í•´ê²°ì±…ì„ ì œê³µí•˜ë©°, ë…ìê°€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ì¶©ë¶„íˆ ì œê³µí•˜ê³ , ê¸€ì˜ íë¦„ì„ ë°©í•´í•˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ ê´€ë ¨ ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê²Œ í’€ì–´ë‚´ì„¸ìš”.
    â—¦ ê²°ë¡ (10-15%): ë‚´ìš©ì„ ìš”ì•½í•˜ê³  ë…ìì˜ í–‰ë™(ì˜ˆ: ëŒ“ê¸€, êµ¬ë§¤ ë“±)ì„ ìœ ë„í•˜ëŠ” ë¬¸êµ¬ë¥¼ í¬í•¨í•˜ì—¬ ë§ˆë¬´ë¦¬í•´ ì£¼ì„¸ìš”.
    â—¦ ë¬¸ë‹¨ êµ¬ë¶„: ë¬¸ì¥ì„ ë‘ ì„¸ ê°œ ì •ë„ ì´ì–´ì„œ ë¬¸ë‹¨ì˜ í˜•íƒœë¡œ ì‘ì„±í•˜ê³ , ë¬¸ë‹¨ êµ¬ë¶„ì„ í™•ì‹¤íˆ í•´ ì£¼ì„¸ìš”.

2. ì²´ë¥˜ ì‹œê°„ ê·¹ëŒ€í™” ì „ëµ:
    â—¦ ì‹œê° ìë£Œ ì ê·¹ í™œìš©: ê¸´ í…ìŠ¤íŠ¸ë¥¼ ë‚˜ëˆ„ëŠ” ìš©ë„ë¡œ ì´ë¯¸ì§€ë¥¼ ì ì ˆíˆ ì‚½ì…í•˜ì—¬ ê°€ë…ì„±ì„ ë†’ì´ê³ , ë…ìì˜ í¥ë¯¸ë¥¼ ìœ ë°œí•˜ì„¸ìš”.
    â—¦ ì†Œí†µ ìœ ë„: ëŒ“ê¸€ê³¼ ì†Œí†µì„ ìœ ë„í•˜ëŠ” ë¬¸êµ¬ë¥¼ í¬í•¨í•˜ì—¬ ì²´ë¥˜ ì‹œê°„ì„ ëŠ˜ë¦¬ì„¸ìš”.

3. ê°€ë…ì„± ë° í¬ë§·íŒ…:
    â—¦ ì¸ìš©êµ¬ ì‚¬ìš©: ë¬¸ë‹¨ì„ êµ¬ë¶„í•˜ê±°ë‚˜ ë‚´ìš©ì„ ê°•ì¡°í•  ë•Œ ì¸ìš©êµ¬ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì—¬ ê¸€ì˜ ì—°ê´€ì„±ì„ ë†’ì´ê³  ê°€ë…ì„±ì„ í–¥ìƒì‹œì¼œ ì£¼ì„¸ìš”.
    â—¦ ì •ë ¬: ê¸°ë³¸ì ìœ¼ë¡œ ì¢Œì¸¡ ì •ë ¬ì„ í•˜ë˜, ë¬¸ì¥ì„ ë‘ ì„¸ ê°œ ì •ë„ ì´ì–´ì„œ ë¬¸ë‹¨ìœ¼ë¡œ ì‘ì„±í•˜ê³  ë¬¸ë‹¨ êµ¬ë¶„ì„ í™•ì‹¤íˆ í•´ì£¼ì„¸ìš”.

[ê²°ê³¼ í˜•ì‹]
ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”:

**ì œëª©:** [í‚¤ì›Œë“œê°€ ì•ì— í¬í•¨ëœ ë§¤ë ¥ì ì¸ ì œëª©]

**ë³¸ë¬¸:**
[ì„œë¡  - í‚¤ì›Œë“œ í¬í•¨, ê³µê°ëŒ€ í˜•ì„±]

[ë³¸ë¡  - êµ¬ì²´ì  ì •ë³´ì™€ í•´ê²°ì±…, ì†Œì œëª© í™œìš©]

[ê²°ë¡  - ìš”ì•½ ë° í–‰ë™ ìœ ë„]

**ì¶”ì²œ íƒœê·¸:** #íƒœê·¸1, #íƒœê·¸2, #íƒœê·¸3, #íƒœê·¸4, #íƒœê·¸5

**ì´ë¯¸ì§€ ì‚½ì… ìœ„ì¹˜:**
- [ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ìœ„ì¹˜ì™€ ì„¤ëª…]
- [ë‘ ë²ˆì§¸ ì´ë¯¸ì§€ ìœ„ì¹˜ì™€ ì„¤ëª…]
- [ì„¸ ë²ˆì§¸ ì´ë¯¸ì§€ ìœ„ì¹˜ì™€ ì„¤ëª…]

**ìµœì¢… ê¸€ììˆ˜:** [ê³µë°± ì œì™¸ ê¸€ììˆ˜]ì
"""
        return prompt.strip()
    
    @staticmethod
    def generate_content_analysis_prompt(keyword: str, structured_data: Dict) -> str:
        """ì½˜í…ì¸  ë¶„ì„ ê¸°ë°˜ AI í”„ë¡¬í”„íŠ¸ ìƒì„±"""
        
        competitor_info = structured_data.get("competitor_analysis", {})
        top_blogs = competitor_info.get("top_blogs", [])
        summary = competitor_info.get("summary", {})
        
        prompt = f"""
# ë¸”ë¡œê·¸ ì½˜í…ì¸  ìƒì„± ìš”ì²­

## ğŸ¯ ëª©í‘œ í‚¤ì›Œë“œ
**"{keyword}"**

## ğŸ“Š ê²½ìŸì‚¬ ë¶„ì„ ë°ì´í„°

### ìƒìœ„ {len(top_blogs)}ê°œ ë¸”ë¡œê·¸ ë¶„ì„ ê²°ê³¼:
"""
        
        # ê° ë¸”ë¡œê·¸ ì •ë³´ ì¶”ê°€
        for i, blog in enumerate(top_blogs, 1):
            prompt += f"""
**{i}ìœ„ ë¸”ë¡œê·¸:**
- ì œëª©: {blog['title']}
- ê¸€ììˆ˜: {blog['statistics']['content_length']}ì
- ì´ë¯¸ì§€: {blog['statistics']['image_count']}ê°œ, GIF: {blog['statistics']['gif_count']}ê°œ, ë™ì˜ìƒ: {blog['statistics']['video_count']}ê°œ
- íƒœê·¸: {', '.join(blog['tags'][:5])}{'...' if len(blog['tags']) > 5 else ''}
- ë‚´ìš© ë¯¸ë¦¬ë³´ê¸°: {blog['content_preview']}
"""
        
        # ì¢…í•© ë¶„ì„
        prompt += f"""
### ğŸ“ˆ ì¢…í•© ë¶„ì„:
- í‰ê·  ê¸€ììˆ˜: {summary.get('avg_content_length', 0)}ì
- ì¸ê¸° íƒœê·¸: {', '.join(summary.get('common_tags', []))}
- ë¶„ì„ ëŒ€ìƒ: {summary.get('total_blogs', 0)}ê°œ ë¸”ë¡œê·¸

## ğŸš€ ìš”ì²­ì‚¬í•­

ë‹¤ìŒ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë¸”ë¡œê·¸ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”:

### 1. ì œëª© ìƒì„±
- "{keyword}" í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ë˜ ê²½ìŸì‚¬ì™€ ì°¨ë³„í™”
- í´ë¦­ì„ ìœ ë„í•˜ëŠ” ë§¤ë ¥ì ì¸ ì œëª©
- SEOì— ìµœì í™”ëœ êµ¬ì¡°

### 2. ì½˜í…ì¸  êµ¬ì¡°
- **ê¸€ììˆ˜**: {summary.get('avg_content_length', 1000) + 200}ì ë‚´ì™¸ (ê²½ìŸì‚¬ë³´ë‹¤ ì•½ê°„ ê¸¸ê²Œ)
- **êµ¬ì„±**: ë„ì… â†’ ë¬¸ì œ ì œê¸° â†’ í•´ê²°ì±… ì œì‹œ â†’ ê²°ë¡ /í–‰ë™ ìœ ë„
- **í†¤ì•¤ë§¤ë„ˆ**: ì¹œê·¼í•˜ê³  ì „ë¬¸ì , ë…ìì˜ ê³ ë¯¼ì— ê³µê°

### 3. SEO ìµœì í™”
- ëª©í‘œ í‚¤ì›Œë“œ ìì—°ìŠ¤ëŸ½ê²Œ ë°°ì¹˜
- ê´€ë ¨ í‚¤ì›Œë“œ ë° ë¡±í…Œì¼ í‚¤ì›Œë“œ í™œìš©
- íƒœê·¸ ì¶”ì²œ: {', '.join(summary.get('common_tags', []))} ê¸°ë°˜ìœ¼ë¡œ 5-8ê°œ

### 4. ì½˜í…ì¸  íŠ¹ì§•
- ì‹¤ìš©ì ì´ê³  actionableí•œ ì •ë³´ ì œê³µ
- ê²½ìŸì‚¬ ëŒ€ë¹„ ì°¨ë³„í™”ëœ ê´€ì ì´ë‚˜ ì •ë³´
- ë…ìì˜ ë¬¸ì œë¥¼ êµ¬ì²´ì ìœ¼ë¡œ í•´ê²°

## ğŸ“ ê²°ê³¼ í˜•ì‹

ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ê²°ê³¼ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”:

```
ì œëª©: [ìƒì„±ëœ ì œëª©]

ë³¸ë¬¸:
[ìƒì„±ëœ ë³¸ë¬¸ ë‚´ìš©]

ì¶”ì²œ íƒœê·¸: [#íƒœê·¸1, #íƒœê·¸2, #íƒœê·¸3, ...]

ì´ë¯¸ì§€ ì‚½ì… ìœ„ì¹˜:
- [ì²« ë²ˆì§¸ ì´ë¯¸ì§€ ìœ„ì¹˜ì™€ ì„¤ëª…]
- [ë‘ ë²ˆì§¸ ì´ë¯¸ì§€ ìœ„ì¹˜ì™€ ì„¤ëª…]
```
"""
        return prompt.strip()
    
    @staticmethod
    def generate_blog_structure_prompt(blog_content_structure: str) -> str:
        """ë¸”ë¡œê·¸ êµ¬ì¡° ê¸°ë°˜ í”„ë¡¬í”„íŠ¸ ìƒì„± (HTML êµ¬ì¡° ë¶„ì„ ë²„ì „)"""
        
        prompt = f"""
# ë¸”ë¡œê·¸ ì½˜í…ì¸  êµ¬ì¡° ë¶„ì„ ë° ì¬ì‘ì„±

## ğŸ“‹ ë¶„ì„ëœ ì½˜í…ì¸  êµ¬ì¡°:

{blog_content_structure}

## ğŸ¯ ìš”ì²­ì‚¬í•­

ìœ„ êµ¬ì¡°ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹¤ìŒì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

### 1. êµ¬ì¡° ë¶„ì„
- ì½˜í…ì¸  íë¦„ íŒ¨í„´ íŒŒì•…
- í…ìŠ¤íŠ¸ì™€ ë¯¸ë””ì–´ì˜ ë°°ì¹˜ ë°©ì‹ ë¶„ì„
- íš¨ê³¼ì ì¸ êµ¬ì„± ìš”ì†Œ ì‹ë³„

### 2. ê°œì„ ëœ ë²„ì „ ì œì‘
- ë™ì¼í•œ êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ë˜ ë‚´ìš©ì€ ì™„ì „íˆ ìƒˆë¡­ê²Œ
- ë” ë§¤ë ¥ì ì´ê³  ìœ ìš©í•œ ì •ë³´ë¡œ ì¬êµ¬ì„±
- SEO ìµœì í™” ê³ ë ¤

### 3. ê²°ê³¼ í˜•ì‹
```
êµ¬ì¡° ë¶„ì„:
[ì›ë³¸ êµ¬ì¡°ì˜ íŠ¹ì§•ê³¼ ì¥ì  ë¶„ì„]

ê°œì„ ëœ ì½˜í…ì¸ :

ì œëª©: [ìƒˆë¡œìš´ ì œëª©]

ë³¸ë¬¸:
[í…ìŠ¤íŠ¸ ë¶€ë¶„]

[ì´ë¯¸ì§€ ìœ„ì¹˜ - ì„¤ëª…: xxx]

[í…ìŠ¤íŠ¸ ë¶€ë¶„]

[GIF ìœ„ì¹˜ - ì„¤ëª…: xxx]

[í…ìŠ¤íŠ¸ ë¶€ë¶„]

[ë™ì˜ìƒ ìœ„ì¹˜ - ì„¤ëª…: xxx]

[í…ìŠ¤íŠ¸ ë¶€ë¶„]

íƒœê·¸: [ì¶”ì²œ íƒœê·¸ë“¤]
```
"""
        return prompt.strip()
    
    @staticmethod
    def generate_simple_rewrite_prompt(title: str, content: str, tags: List[str]) -> str:
        """ê°„ë‹¨í•œ ë¦¬ë¼ì´íŒ… í”„ë¡¬í”„íŠ¸"""
        
        prompt = f"""
# ë¸”ë¡œê·¸ ê¸€ ë¦¬ë¼ì´íŒ… ìš”ì²­

## ì›ë³¸ ì½˜í…ì¸ :
**ì œëª©:** {title}
**íƒœê·¸:** {', '.join(tags)}

**ë‚´ìš©:**
{content}

## ìš”ì²­ì‚¬í•­:
1. ë™ì¼í•œ ì£¼ì œì™€ ì •ë³´ë¥¼ ë‹¤ë£¨ë˜ ì™„ì „íˆ ìƒˆë¡œìš´ ë¬¸ì²´ì™€ êµ¬ì„±ìœ¼ë¡œ ì‘ì„±
2. ë” ë§¤ë ¥ì ì´ê³  ì½ê¸° ì‰¬ìš´ ê¸€ë¡œ ê°œì„ 
3. SEO ìµœì í™” ê³ ë ¤
4. ì›ë³¸ë³´ë‹¤ 10-20% ë” ê¸¸ê²Œ ì‘ì„±

## ê²°ê³¼ í˜•ì‹:
```
ì œëª©: [ìƒˆë¡œìš´ ì œëª©]

ë³¸ë¬¸:
[ë¦¬ë¼ì´íŒ…ëœ ë‚´ìš©]

ì¶”ì²œ íƒœê·¸: [#íƒœê·¸1, #íƒœê·¸2, ...]
```
"""
        return prompt.strip()


def create_ai_request_data(keyword: str, analyzed_blogs: List[Dict]) -> Dict:
    """AI ìš”ì²­ìš© ë°ì´í„° ìƒì„±"""
    try:
        structure_analyzer = BlogContentStructure()
        structured_data = structure_analyzer.analyze_blog_structure(analyzed_blogs)
        structured_data["keyword"] = keyword
        
        # AI í”„ë¡¬í”„íŠ¸ ìƒì„±
        prompt_generator = BlogAIPrompts()
        ai_prompt = prompt_generator.generate_content_analysis_prompt(keyword, structured_data)
        
        return {
            "structured_data": structured_data,
            "ai_prompt": ai_prompt,
            "raw_blogs": analyzed_blogs
        }
        
    except Exception as e:
        logger.error(f"AI ìš”ì²­ ë°ì´í„° ìƒì„± ì‹¤íŒ¨: {e}")
        return {}


# ì‚¬ìš© ì˜ˆì‹œ
if __name__ == "__main__":
    # í…ŒìŠ¤íŠ¸ìš© ë°ì´í„°
    test_blogs = [
        {
            "rank": 1,
            "title": "ê°•ì•„ì§€ ë‹¤ì´ì–´íŠ¸ ì‚¬ë£Œ ì¶”ì²œ",
            "content_length": 1247,
            "image_count": 8,
            "gif_count": 2,
            "video_count": 1,
            "tags": ["#ê°•ì•„ì§€ì‚¬ë£Œ", "#ë‹¤ì´ì–´íŠ¸", "#ì¶”ì²œ"],
            "text_content": "ê°•ì•„ì§€ ë‹¤ì´ì–´íŠ¸ì— ëŒ€í•œ ë‚´ìš©..."
        }
    ]
    
    # AI ìš”ì²­ ë°ì´í„° ìƒì„±
    ai_data = create_ai_request_data("ê°•ì•„ì§€ ë‹¤ì´ì–´íŠ¸ ì‚¬ë£Œ", test_blogs)
    print(ai_data["ai_prompt"])